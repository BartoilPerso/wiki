# OpenIPC Wiki
[Оглавление](../index.md)

Switcam HS-303
--------------

Компания-производитель выпускала IP камеры Switcam HS-303 в трёх версиях,
значительно отличающихся аппаратно между собой. На данный момент проект
OpenIPC поддерживает все три типа камер, однако установка альтернативного ПО
без разборки устройства возможна пока только на v1 и v2 типах устройств.

Мы работаем над созданием новой универсальной прошивки для всех трёх типов
видеокамеры Switcam HS-303. Обсуждение проекта и возможностей прошивок (на
русском языке) возможно в открытой группе [Telegram](https://t.me/openipc_modding).

Так-же в ближайшее время все информационные наработки по видеокамерам в виде 
Q&A будут перенесены в данный документ общей Wiki.



## подготовка перед прошивкой и эксплуатацией

Для комфортной работы в камерами OpenIPC в Windows необходимо установить программы:

* Putty для доступа по протоколу ssh (вместо telnet)
* WinSCP для доступа к файловой системе по протоколу scp
* Notepad++ в качестве редактора файлов на Linux камере

Для входа по SSH необходимо использовать имя пользователя root, без пароля



## HS303 v1 и v2

### Краткая инструкция установки OpenIPC v2.2 (на 2022.07.20)

- подключите SD/MMC карту к ПК и разбейте её на два раздела
- карта может быть любого размера, но первый раздел должен быть не более 2GB
- отформатируйте SD/MMC карту как FAT (ограничение 2GB)
- распакуйте содержимое архива в корень SD/MMC карты
- вставьте карту памяти и подайте питание на камеру
- через 2 минуты (обновится загрузчик), сделайте сброс питания на пару секунд
- примерно через 2 минуты камера щелкнет ИК фильтром два раза
- вытащите SD/MMC карту, камера готова к эксплуатации
- можно выполнить обновление через интернет командой `sysupgrade -k -r`

По-умолчанию камера пытается соединиться с точкой доступа с именем OpenIPC_NFS
и паролем сети project2021. Для изменения имени сети и пароля перед прошивкой
устройства, откройте файл autoconfig/etc/network/interfaces на SD/MMC карте в
редакторе Notepad++ (для Windows), выбрав при этом кодировку UTF-8 и впишите
свои значения.

После прошивки устройства не забудьте удалить все файлы autoupdate*, так как
при каждой подаче питания камера будет пытаться обновиться, что в итоге может
привести к неисправности. После окончательной настройки, если планируете
использовать SD/MMC карту для записи видео, не забудьте удалить каталог с 
конфигурационными файлами, предварительно сохранив его себе на ПК.


#### Особенности релиза

- что-бы было больше свободной памяти, по-умолчанию отключен HLS, т.е. видео
  в браузере по дефолтному порту не будет, используйте 85 порт для интерфейса
  с настройками
- для тех кто будет перепрошивать камеры с OpenWrt понадобятся дополнительные
  действия в виде разового выполнения команды в старой прошивке, зайдя на камеру
  по SSH `flash_eraseall -j /dev/mtd4; reboot -f`



### Наиболее актуальные вопросы и ответы

#### Где можно взять прошивку для устройства Ростелеком Switcam HS303(v2)?

Обсуждение работы этих камер доступно по специальной подписке на
[OpenIPC paywall](https://paywall.pw/openipc).

#### Как узнать какой IP адрес у прошитой камеры и как зайти на неё ?

Если внесены корректные данные по настройке WiFi интерфейса в конфигурационный
файл (SSID и ключ), то вы можете найти IP адрес камеры на своём роутере в списке
подключенных устройств с пометкой "OpenIPC".
Интерфейс управления камерой доступен в браузере на порту 85, а доступ по SSH
возможен на стандартном порту 22 с использованием логина root, без пароля при
первом подключении.

#### Как можно обновить прошивку до последней актуальной версии через SSH ?

Зайдите на камеру по протоколу SSH через программу Putty (логин root, без пароля,
22 порт) и выполните команду:

```
sysupgrade -k -r
```

При наличии интернета, камера автоматически подключится к GitHub, скачает
и установит самые последние обновления.

В случае, если выполнение данной команды приводит к зависанию камеры, можно
воспользоваться специальной командой выполнения обновленного скрипта:

```
curl -s https://raw.githubusercontent.com/OpenIPC/firmware/master/general/overlay/usr/sbin/sysupgrade | sh -s -- -r -k
```

#### Как можно обновить прошивку до последней актуальной версии через WEB ?

Зайдите на камеру через браузер указав IP адрес камеры и порт подключения 85,
например вот так:

```
http://192.168.1.253:85
```

Введите дефолтные логин и пароль (логин admin, пароль 12345).
После захода на камеру, установите новый пароль (не забудьте его записать!) и
выберите язык интерфейса. В разделе Firmware/Прошивка выполните действия,
которые указаны в подсказках.

#### Как зарегистрировать данный тип камеры на сервисе ipeye.ru ?

В личном кабинете IPeye добавить камеру по ID, в качестве которого использовать MAC
написанный в нижнем регистре (маленькими буквами). MAC написан на титульной 
странице WEB-интерфейса на 85 порту.

#### Как включить микрофон на камере при стриме на ipeye.ru ?

В свойствах основного видеопотока установите тип кодека как ```alaw```
Это можно сделать подключившись по ssh в редакторе vi, подключившись через
WinSCP по протоколу scp через редактор Notepad++, так и через WEB-интерфейс
на 85 порту в разделе Majestic.

```
audio:
  enabled: true
  volume: auto
  srate: 8000
  codec: alaw
```

#### Какой путь до SD карты необходимо указывать в `majestic.yaml` ?

`/mnt/mmcblk0p1/%Y/%m/%d/%H/%M.mp4`
